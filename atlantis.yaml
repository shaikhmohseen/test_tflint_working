---
version: 3
projects:
  # platform resources

  - dir: accounts/medly-dev/authoriser_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/cloudfront_proxy
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/cloudfront_proxy_providers
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/iam_system_users
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/eb_atlantis
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/global_ssm_parameters
    autoplan:
      when_modified: [ "../../../modules/global/ssm", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/iam
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/kinesis_streams
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/primerx_ingest
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/s3
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/tfstate
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/trigger_deployment
    autoplan:
      when_modified: [ "../../../modules/services/trigger_deployment/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  # deployment pipelines

  - dir: accounts/medly-dev/deployment_pipeline/ibd_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/delivery_hospitals_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/delivery_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/facility_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/insurance_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/mms_ingest_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/onfleet_hospitals_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/onfleet_internal_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/particle_health_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/patient_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/payment_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/prescription_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/rx_ingestion_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/rx_task_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/satellite_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/scheduling_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/deployment_pipeline/watchtower_service
    autoplan:
      when_modified: [ "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  # web apps

  - dir: accounts/medly-dev/delivery_app
    autoplan:
      when_modified: [ "../../../modules/apps/delivery_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/delivery_hospital_app
    autoplan:
      when_modified: [ "../../../modules/apps/delivery_hospital_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt
  - dir: accounts/medly-dev/rx_app
    autoplan:
      when_modified: [ "../../../modules/apps/rx_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/ibd_app
    autoplan:
      when_modified: [ "../../../modules/apps/ibd_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/insurance_app
    autoplan:
      when_modified: [ "../../../modules/apps/insurance_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/particle_health_app
    autoplan:
      when_modified: [ "../../../modules/apps/particle_health_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/connect_app
    autoplan:
      when_modified: [ "../../../modules/apps/connect_app/*.tf", "../../../modules/resources/okta_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/px_app
    autoplan:
      when_modified: [ "../../../modules/apps/px_app/*.tf", "../../../modules/resources/okta_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/satellite_app
    autoplan:
      when_modified: [ "../../../modules/apps/satellite_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/watchtower_app
    autoplan:
      when_modified: [ "../../../modules/apps/watchtower_app/*.tf", "../../../modules/resources/okta_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/rx_suggestion_app
    autoplan:
      when_modified: [ "../../../modules/apps/rx_suggestion_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/shipment_app
    autoplan:
      when_modified: [ "../../../modules/apps/shipment_app/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  # services
  - dir: accounts/medly-dev/awerex_service
    autoplan:
      when_modified: [ "../../../modules/services/awerex_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/consumer_profile_service
    autoplan:
      when_modified: [ "../../../modules/services/consumer_profile_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/delivery_hospitals_service
    autoplan:
      when_modified: [ "../../../modules/services/delivery_hospitals_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/delivery_service
    autoplan:
      when_modified: [ "../../../modules/services/delivery_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/facility_service
    autoplan:
      when_modified: [ "../../../modules/services/facility_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/ibd_service
    autoplan:
      when_modified: [ "../../../modules/services/ibd_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/insurance_service
    autoplan:
      when_modified: [ "../../../modules/services/insurance_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/mms_ingest_service
    autoplan:
      when_modified: [ "../../../modules/services/mms_ingest_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/onfleet_hospitals_service
    autoplan:
      when_modified: [ "../../../modules/services/onfleet_hospitals_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/onfleet_internal_service
    autoplan:
      when_modified: [ "../../../modules/services/onfleet_internal_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/particle_health_service
    autoplan:
      when_modified: [ "../../../modules/services/particle_health_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/partners_service
    autoplan:
      when_modified: [ "../../../modules/services/partners_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/patient_service
    autoplan:
      when_modified: [ "../../../modules/services/patient_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/payment_service
    autoplan:
      when_modified: [ "../../../modules/services/payment_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/prescription_service
    autoplan:
      when_modified: [ "../../../modules/services/prescription_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/rx_ingestion_service
    autoplan:
      when_modified: [ "../../../modules/services/rx_ingestion_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/refill_management_service
    autoplan:
      when_modified: [ "../../../modules/services/refill_management_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/rx_task_service
    autoplan:
      when_modified: [ "../../../modules/services/rx_task_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/satellite_service
    autoplan:
      when_modified: [ "../../../modules/services/satellite_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/scheduling_service
    autoplan:
      when_modified: [ "../../../modules/services/scheduling_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/watchtower_service
    autoplan:
      when_modified: [ "../../../modules/services/watchtower_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/shipment_service
    autoplan:
      when_modified: [ "../../../modules/services/shipment_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

  - dir: accounts/medly-dev/rx_suggestion_service
    autoplan:
      when_modified: [ "../../../modules/services/rx_suggestion_service/*.tf", "*.tf*", "terragrunt.hcl" ]
    workflow: terragrunt

workflows:
  terragrunt:
    plan:
      steps:
        - run: terragrunt plan -no-color -out=$PLANFILE
    apply:
      steps:
        - run: terragrunt apply -no-color $PLANFILE
